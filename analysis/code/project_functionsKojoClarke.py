{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "00cdc923-65cf-4c50-9ee0-5cde64c5d434",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>fund_symbol</th>\n",
       "      <th>Year</th>\n",
       "      <th>Value</th>\n",
       "      <th>Date</th>\n",
       "      <th>cumulative_value</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2540</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2000</td>\n",
       "      <td>5.032</td>\n",
       "      <td>2000-02-01</td>\n",
       "      <td>5.032</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2413</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2001</td>\n",
       "      <td>-1.485</td>\n",
       "      <td>2001-02-01</td>\n",
       "      <td>3.547</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2286</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2002</td>\n",
       "      <td>2.755</td>\n",
       "      <td>2002-02-01</td>\n",
       "      <td>6.302</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2159</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2003</td>\n",
       "      <td>7.062</td>\n",
       "      <td>2003-02-01</td>\n",
       "      <td>13.364</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2032</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2004</td>\n",
       "      <td>6.361</td>\n",
       "      <td>2004-02-01</td>\n",
       "      <td>19.725</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>634</th>\n",
       "      <td>YAFFX</td>\n",
       "      <td>2016</td>\n",
       "      <td>11.291</td>\n",
       "      <td>2016-02-01</td>\n",
       "      <td>211.221</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>507</th>\n",
       "      <td>YAFFX</td>\n",
       "      <td>2017</td>\n",
       "      <td>20.031</td>\n",
       "      <td>2017-02-01</td>\n",
       "      <td>231.252</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>380</th>\n",
       "      <td>YAFFX</td>\n",
       "      <td>2018</td>\n",
       "      <td>2.881</td>\n",
       "      <td>2018-02-01</td>\n",
       "      <td>234.133</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>253</th>\n",
       "      <td>YAFFX</td>\n",
       "      <td>2019</td>\n",
       "      <td>19.132</td>\n",
       "      <td>2019-02-01</td>\n",
       "      <td>253.265</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>126</th>\n",
       "      <td>YAFFX</td>\n",
       "      <td>2020</td>\n",
       "      <td>17.254</td>\n",
       "      <td>2020-02-01</td>\n",
       "      <td>270.519</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2667 rows Ã— 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     fund_symbol  Year   Value       Date  cumulative_value\n",
       "2540       AFRAX  2000   5.032 2000-02-01             5.032\n",
       "2413       AFRAX  2001  -1.485 2001-02-01             3.547\n",
       "2286       AFRAX  2002   2.755 2002-02-01             6.302\n",
       "2159       AFRAX  2003   7.062 2003-02-01            13.364\n",
       "2032       AFRAX  2004   6.361 2004-02-01            19.725\n",
       "...          ...   ...     ...        ...               ...\n",
       "634        YAFFX  2016  11.291 2016-02-01           211.221\n",
       "507        YAFFX  2017  20.031 2017-02-01           231.252\n",
       "380        YAFFX  2018   2.881 2018-02-01           234.133\n",
       "253        YAFFX  2019  19.132 2019-02-01           253.265\n",
       "126        YAFFX  2020  17.254 2020-02-01           270.519\n",
       "\n",
       "[2667 rows x 5 columns]"
      ]
     },
     "execution_count": 16,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "\n",
    "def process_mutual_fund_data(file_path):\n",
    "    data1 = pd.read_csv(file_path)\n",
    "    year_columns = [col for col in data1.columns if col.startswith('fund_return_')]\n",
    "\n",
    "    df_melted = (data1.melt(id_vars=['fund_symbol'], value_vars=year_columns, var_name='Year', value_name='Value')\n",
    "                 .assign(Year=lambda x: x['Year'].str.extract('(\\d{4})'),\n",
    "                         Date=lambda x: pd.to_datetime(x['Year'], format='%Y') + pd.offsets.MonthBegin(1),\n",
    "                         Value=lambda x: x['Value'] * 100)\n",
    "                 .sort_values(['fund_symbol', 'Year'])\n",
    "                 .assign(cumulative_value=lambda x: x.groupby('fund_symbol')['Value'].cumsum())\n",
    "                )\n",
    "\n",
    "    return df_melted\n",
    "\n",
    "\n",
    "file_path = '../../data/processed/MutualFund'\n",
    "result_df = process_mutual_fund_data(file_path)\n",
    "result_df\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "ba0128eb-b626-44af-a687-e07cc1987dcb",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Date</th>\n",
       "      <th>Value</th>\n",
       "      <th>Year</th>\n",
       "      <th>cumulative_value</th>\n",
       "      <th>fund_symbol</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2000-12-29</td>\n",
       "      <td>-10.14</td>\n",
       "      <td>2000</td>\n",
       "      <td>-10.14</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2001-12-31</td>\n",
       "      <td>-13.04</td>\n",
       "      <td>2001</td>\n",
       "      <td>-23.18</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2002-12-31</td>\n",
       "      <td>-23.37</td>\n",
       "      <td>2002</td>\n",
       "      <td>-46.55</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2003-12-31</td>\n",
       "      <td>26.38</td>\n",
       "      <td>2003</td>\n",
       "      <td>-20.17</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2004-12-31</td>\n",
       "      <td>8.99</td>\n",
       "      <td>2004</td>\n",
       "      <td>-11.18</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2005-12-30</td>\n",
       "      <td>3.00</td>\n",
       "      <td>2005</td>\n",
       "      <td>-8.18</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2006-12-29</td>\n",
       "      <td>13.62</td>\n",
       "      <td>2006</td>\n",
       "      <td>5.44</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2007-12-31</td>\n",
       "      <td>3.53</td>\n",
       "      <td>2007</td>\n",
       "      <td>8.97</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2008-12-31</td>\n",
       "      <td>-38.49</td>\n",
       "      <td>2008</td>\n",
       "      <td>-29.52</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2009-12-31</td>\n",
       "      <td>23.45</td>\n",
       "      <td>2009</td>\n",
       "      <td>-6.07</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2010-12-31</td>\n",
       "      <td>12.78</td>\n",
       "      <td>2010</td>\n",
       "      <td>6.71</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2011-12-30</td>\n",
       "      <td>0.00</td>\n",
       "      <td>2011</td>\n",
       "      <td>6.71</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2012-12-31</td>\n",
       "      <td>13.41</td>\n",
       "      <td>2012</td>\n",
       "      <td>20.12</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2013-12-31</td>\n",
       "      <td>29.60</td>\n",
       "      <td>2013</td>\n",
       "      <td>49.72</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2014-12-31</td>\n",
       "      <td>11.39</td>\n",
       "      <td>2014</td>\n",
       "      <td>61.11</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2015-12-31</td>\n",
       "      <td>-0.73</td>\n",
       "      <td>2015</td>\n",
       "      <td>60.38</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2016-12-30</td>\n",
       "      <td>9.54</td>\n",
       "      <td>2016</td>\n",
       "      <td>69.92</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2017-12-29</td>\n",
       "      <td>19.42</td>\n",
       "      <td>2017</td>\n",
       "      <td>89.34</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2018-12-31</td>\n",
       "      <td>-6.24</td>\n",
       "      <td>2018</td>\n",
       "      <td>83.10</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>2019-12-31</td>\n",
       "      <td>28.88</td>\n",
       "      <td>2019</td>\n",
       "      <td>111.98</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>2020-12-31</td>\n",
       "      <td>16.26</td>\n",
       "      <td>2020</td>\n",
       "      <td>128.24</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>2021-12-31</td>\n",
       "      <td>26.89</td>\n",
       "      <td>2021</td>\n",
       "      <td>155.13</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>2022-12-31</td>\n",
       "      <td>-19.44</td>\n",
       "      <td>2022</td>\n",
       "      <td>135.69</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>2023-02-17</td>\n",
       "      <td>6.24</td>\n",
       "      <td>2023</td>\n",
       "      <td>141.93</td>\n",
       "      <td>S&amp;P500</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          Date  Value  Year  cumulative_value fund_symbol\n",
       "0   2000-12-29 -10.14  2000            -10.14      S&P500\n",
       "1   2001-12-31 -13.04  2001            -23.18      S&P500\n",
       "2   2002-12-31 -23.37  2002            -46.55      S&P500\n",
       "3   2003-12-31  26.38  2003            -20.17      S&P500\n",
       "4   2004-12-31   8.99  2004            -11.18      S&P500\n",
       "5   2005-12-30   3.00  2005             -8.18      S&P500\n",
       "6   2006-12-29  13.62  2006              5.44      S&P500\n",
       "7   2007-12-31   3.53  2007              8.97      S&P500\n",
       "8   2008-12-31 -38.49  2008            -29.52      S&P500\n",
       "9   2009-12-31  23.45  2009             -6.07      S&P500\n",
       "10  2010-12-31  12.78  2010              6.71      S&P500\n",
       "11  2011-12-30   0.00  2011              6.71      S&P500\n",
       "12  2012-12-31  13.41  2012             20.12      S&P500\n",
       "13  2013-12-31  29.60  2013             49.72      S&P500\n",
       "14  2014-12-31  11.39  2014             61.11      S&P500\n",
       "15  2015-12-31  -0.73  2015             60.38      S&P500\n",
       "16  2016-12-30   9.54  2016             69.92      S&P500\n",
       "17  2017-12-29  19.42  2017             89.34      S&P500\n",
       "18  2018-12-31  -6.24  2018             83.10      S&P500\n",
       "19  2019-12-31  28.88  2019            111.98      S&P500\n",
       "20  2020-12-31  16.26  2020            128.24      S&P500\n",
       "21  2021-12-31  26.89  2021            155.13      S&P500\n",
       "22  2022-12-31 -19.44  2022            135.69      S&P500\n",
       "23  2023-02-17   6.24  2023            141.93      S&P500"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import pandas as pd\n",
    "\n",
    "def process_sp500_data(file_path, start_date=2000):\n",
    "    data2 = pd.read_csv(file_path)\n",
    "\n",
    "    data2f = (data2.loc[data2['year'] >= start_date]\n",
    "              .reset_index(drop=True)\n",
    "              .assign(fund_symbol='S&P500',\n",
    "                      cumulative_value=lambda x: x[' value'].cumsum())\n",
    "              .rename(columns={'year': 'Year', 'date': 'Date', ' value': 'Value'})\n",
    "             )\n",
    "\n",
    "    return data2f\n",
    "\n",
    "\n",
    "file_path = '../../data/processed/S&P'\n",
    "result_df = process_sp500_data(file_path)\n",
    "result_df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "d1127e47-acbc-4498-892e-14b4e78f9b3b",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>fund_symbol</th>\n",
       "      <th>Year</th>\n",
       "      <th>Value</th>\n",
       "      <th>Date</th>\n",
       "      <th>cumulative_value</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2000</td>\n",
       "      <td>5.032</td>\n",
       "      <td>2000-02-01 00:00:00</td>\n",
       "      <td>5.032</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2001</td>\n",
       "      <td>-1.485</td>\n",
       "      <td>2001-02-01 00:00:00</td>\n",
       "      <td>3.547</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2002</td>\n",
       "      <td>2.755</td>\n",
       "      <td>2002-02-01 00:00:00</td>\n",
       "      <td>6.302</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2003</td>\n",
       "      <td>7.062</td>\n",
       "      <td>2003-02-01 00:00:00</td>\n",
       "      <td>13.364</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>AFRAX</td>\n",
       "      <td>2004</td>\n",
       "      <td>6.361</td>\n",
       "      <td>2004-02-01 00:00:00</td>\n",
       "      <td>19.725</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2686</th>\n",
       "      <td>S&amp;P500</td>\n",
       "      <td>2019</td>\n",
       "      <td>28.880</td>\n",
       "      <td>2019-12-31</td>\n",
       "      <td>111.980</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2687</th>\n",
       "      <td>S&amp;P500</td>\n",
       "      <td>2020</td>\n",
       "      <td>16.260</td>\n",
       "      <td>2020-12-31</td>\n",
       "      <td>128.240</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2688</th>\n",
       "      <td>S&amp;P500</td>\n",
       "      <td>2021</td>\n",
       "      <td>26.890</td>\n",
       "      <td>2021-12-31</td>\n",
       "      <td>155.130</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2689</th>\n",
       "      <td>S&amp;P500</td>\n",
       "      <td>2022</td>\n",
       "      <td>-19.440</td>\n",
       "      <td>2022-12-31</td>\n",
       "      <td>135.690</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2690</th>\n",
       "      <td>S&amp;P500</td>\n",
       "      <td>2023</td>\n",
       "      <td>6.240</td>\n",
       "      <td>2023-02-17</td>\n",
       "      <td>141.930</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2691 rows Ã— 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     fund_symbol  Year   Value                 Date  cumulative_value\n",
       "0          AFRAX  2000   5.032  2000-02-01 00:00:00             5.032\n",
       "1          AFRAX  2001  -1.485  2001-02-01 00:00:00             3.547\n",
       "2          AFRAX  2002   2.755  2002-02-01 00:00:00             6.302\n",
       "3          AFRAX  2003   7.062  2003-02-01 00:00:00            13.364\n",
       "4          AFRAX  2004   6.361  2004-02-01 00:00:00            19.725\n",
       "...          ...   ...     ...                  ...               ...\n",
       "2686      S&P500  2019  28.880           2019-12-31           111.980\n",
       "2687      S&P500  2020  16.260           2020-12-31           128.240\n",
       "2688      S&P500  2021  26.890           2021-12-31           155.130\n",
       "2689      S&P500  2022 -19.440           2022-12-31           135.690\n",
       "2690      S&P500  2023   6.240           2023-02-17           141.930\n",
       "\n",
       "[2691 rows x 5 columns]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "merged_df = pd.concat([df_melted, data2f], ignore_index=True)\n",
    "merged_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d34112b0-2602-4a28-9b64-f79f4f8d5bcf",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
